<!DOCTYPE html>
<html lang="en">
<style>
  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  td,
  th {
    border: 1px solid #dddddd;
    text-align: center;
    padding: 8px;
  }

  tr:nth-child(even) {
    background-color: #dddddd;
  }
</style>

<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
</style>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>

  function downloadCSV(csv, filename) {
    var csvFile;
    var downloadLink;

    // CSV file
    csvFile = new Blob([csv], { type: "text/csv" });

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // Create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Hide download link
    downloadLink.style.display = "none";

    // Add the link to DOM
    document.body.appendChild(downloadLink);

    // Click download link
    downloadLink.click();
  }

  function exportTableToCSV() {
    var csv = [];
    var rows = document.querySelectorAll("table tr");

    for (var i = 0; i < rows.length; i++) {


      var row = [], cols = rows[i].querySelectorAll("td, th");

      if (i == 0) {
        row.push("category");
        row.push("polarity");
        row.push("review_id");
        row.push("text");
        csv.push(row.join("\t"));
        continue;
      }

      for (var j = 0; j < cols.length; j++) {
        var slct = cols[j].querySelectorAll("select option:checked");


        for (var k = 0; k < slct.length; k++) {
          row.push(slct[k].value);
        }
        if (j > 3) {
          row.push(cols[0].innerText);
          row.push(cols[1].innerText);
        }


      }
      csv.push(row.join("\t"));
    }

    // Download CSV file
    var filename;
    var today = new Date();
    var time = today.getDate() + "-" + today.getHours() + "-" + today.getMinutes() + "-" + today.getSeconds();
    filename = time + ".csv";
    downloadCSV(csv.join("\n"), filename);
  }
</script>

<head>
  <meta charset="UTF-8">
  <title>File Test</title>

</head>


<body>
  <script>

    $(function () {

      

      $(document).ready(function () {
        $('#thetable').DataTable();
      });


      $(document).on('click', '.addRow', function () {
        var myRow = $(this).parents('tr').clone();
        var index = $(this).parents('tr').index();



        var categoryData = $(this).closest('tr').find('#catid').find("#catselect option:selected").val();
        var polarityData = $(this).closest('tr').find('#polid').find("#polselect option:selected").val();
        var textData = $(this).closest('tr').find('#textid').text();
        var revData = $(this).closest('tr').find('#revid').text();


        myRow.closest('tr').find('#catid').find("#catselect").val(categoryData);
        myRow.closest('tr').find('#polid').find("#polselect").val(polarityData);


        $('#thetable > tbody > tr').eq(index).after(myRow);
        
      });

      $(document).on('click', '.remove', function () {
        $(this).parents('tr').remove();
        
      });
    })
  </script>


  <form action="{{ url_for('index') }}" enctype="multipart/form-data" method="POST">
    <input name="file" type="file">

    <input type="submit" value="Upload">
  </form>

  {% if display %}
  <form action="{{ url_for('submit') }}" method="POST">



    <br><br>
    <fieldset style="background-color:white;">
      <table id="thetable">
        <thead>
          <tr>
            <th>Review ID</th>
            <th>Text</th>
            <th>Category</th>
            <th>Polarity</th>
          </tr>
        </thead>

        <tbody>
          {% for e in evaluation %}
          {% set loop1 = loop %}
          
          
          
          <tr>
              
            {% if loop1.index0 != 0 %}
            {% set category = e[0] %}
            {% set polarity = e[1] %}
            {% set rev_id = e[2] %}
            {% set text = e[3] %}

            <td style="width:10%;" id="revid">{{rev_id}}</td>
            <td id="textid">{{text}}</td>

            <td id="catid"><select id="catselect" name="category{{ loop1.index0 }}">
                {% if category == "presentation" %}
                <option value="presentation" selected="selected">Presentation</option>
                <option value="knowledge">Knowledge</option>
                <option value="grading">Grading</option>
                {% elif category == "knowledge" %}
                <option value="presentation">Presentation</option>
                <option value="knowledge" selected="selected">Knowledge</option>
                <option value="grading">Grading</option>
                {% else %}
                <option value="presentation">Presentation</option>
                <option value="knowledge">Knowledge</option>
                <option value="grading" selected="selected">Grading</option>
                {% endif %}
              </select></td>


            <td id="polid"><select id="polselect" name="polarity{{ loop1.index0 }}">
                {% if polarity == "positive" %}
                <option value="positive" selected="selected">Positive</option>
                <option value="negative">Negative</option>
                {% else %}
                <option value="positive">Positive</option>
                <option value="negative" selected="selected">Negative</option>
                {% endif %}
              </select></td>

            <td>
              <button type="button" class="addRow"> Add Row </button>
              <button type="button" class="remove"> Remove Row </button>
            </td>

            <input onclick="return false" style="opacity:0;" type="checkbox" name="check" value='{{e[2], e[3]}}'
              checked />
            {% endif %}
             
          </tr>
          
          {% endfor %}
        </tbody>
      </table>

    </fieldset>
    <br>

    <button type="button" onclick="exportTableToCSV()" id="export">Export</button>



  </form>
  {% endif %}
</body>


</html>